function getValidDataScope(onlyOnSelectedRows,chartDataUniverse){return onlyOnSelectedRows?chartDataUniverse.getSelectedRowsData():chartDataUniverse.data}function aggregate(dataToAgg,y){var aggFnMap={SUM:ss.sum,AVERAGE:ss.average,COUNT:function(x){return _.uniq(x).length},COUNT_AND_DISTINCT:function(x){return _.uniq(x).length}},dataArray=_.pluck(dataToAgg,y.colTag),aggFn=aggFnMap[y.aggregationMethod];return aggFn(dataArray)}"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(suffix){return-1!==this.indexOf(suffix,this.length-suffix.length)}),Date.prototype.getYYYYMMDD=function(){var month=this.getMonth()+1;month=1==month.toString().length?"0"+month:month;var day=this.getDate();return day=1==day.toString().length?"0"+day:day,this.getFullYear()+"-"+month+"-"+day};const $script=$("script[src]"),src=$script[$script.length-1].src,scriptFolder=src.substr(0,src.lastIndexOf("/")+1);angular.module("decorated-high-charts",["ui.bootstrap","typeahead-focus"]),angular.module("decorated-high-charts").directive("decoratedHighCharts",function(chartFactory,$timeout){return{restrict:"E",scope:{chartProperties:"=",data:"=",key:"@",numericalColumns:"=",categoricalColumns:"=",customButtons:"=?",beforeRender:"&?",afterRender:"&?",removeSeriesCallback:"&?",pointRemovalCallback:"&?",resetExcludedPointsCallback:"&?",apiHandle:"=",getSelectedRowsData:"&?",showOnlySelectedRows:"=?",scatterPlotPointClickCallback:"&?",chartTitle:"@?",chartOptions:"=?"},controller:function($scope,$element){$scope.chartOptions=$scope.chartOptions||{},$scope.chartProperties.dataToShow=$scope.chartProperties.dataToShow?$scope.chartProperties.dataToShow:"all",_.each(chartFactory.getRelevantProperties($scope.chartProperties),function(property){$scope.chartProperties[property]=$scope.chartProperties[property]?_.findWhere($scope.numericalColumns.concat($scope.categoricalColumns),{colTag:$scope.chartProperties[property].colTag}):void 0}),$scope.chartId=_.uniqueId("decorated-highchart-"),$scope.$flexibleRemoveBtn=$('<i class="fa fa-remove clickable"></i>').css({position:"absolute","z-index":.99,color:"red"})},link:function(scope,elem,attrs){function getVisualizationTypes(column){return _.map(column.visualizationTypes,function(type){return type.replace("_"," ").toUpperCase()})}function createHighchart(opts){return new Highcharts.Chart(opts,function(chart){})}scope.chartFactory=chartFactory,scope.alerts={generalWarning:{active:!1,message:""}},scope.states={menuDisplays:{moreOptions:!1,changeChartType:!1},needAttrs:!1,adHocSeriesOptions:[]},elem.bind("contextmenu",function(){return!1}),scope.$ctxMenu=dhc.buildContextMenuContainer(elem),scope.toggleSlide=function(show,className){const camelCaseName=attrs.$normalize(className);scope.states.menuDisplays[camelCaseName]=show;var $ctrl=elem.find("."+className);show?($ctrl.slideDown(500),$ctrl.find("input").first().select()):$ctrl.slideUp(500),$timeout(function(){})},scope.allPanelHidden=function(){return scope.chartOptions.disableExporting&&scope.chartOptions.disableChartType&&scope.chartOptions.disableMoreOptions&&scope.chartOptions.disablePropertyChooser},scope.getRegressionText=function(){return scope.chartProperties.regression?_.findWhere(chartFactory.regressionTypes,{tag:scope.chartProperties.regression}).text:"No Regression"},scope.getValidColumns=function(columnSet){return _.filter(columnSet,function(column){return getVisualizationTypes(column).indexOf(scope.chartProperties.type.toUpperCase())>-1})},scope.changeChartType=function(){const categoricalColumns=["group_by"];$timeout(function(){_.each(scope.apiHandle.api.getRelevantProperties(),function(prop){categoricalColumns.indexOf(prop)>-1?-1==scope.getValidColumns(scope.categoricalColumns).indexOf(scope.chartProperties[prop])&&delete scope.chartProperties[prop]:-1==scope.getValidColumns(scope.numericalColumns).indexOf(scope.chartProperties[prop])&&delete scope.chartProperties[prop]}),scope.apiHandle.api.timeoutLoadChart()})},scope.exportXLS=function(){var html=dhc.chartToHTML(scope.states.chart);window.navigator.msSaveBlob?window.navigator.msSaveBlob(new Blob([html]),"time-series-export.xls"):window.open("data:application/vnd.ms-excel,"+encodeURIComponent(html))},scope.exportPDF=function(){scope.states.chart.exportChart({type:"application/pdf",filename:"chart-export "+scope.states.chart.title.textStr})},scope.removeSeries=function(series){if(series){const id=series.id||series.options.id;series.remove(),scope.removeSeriesCallback({series:id})}},scope.apiHandle.api={excludedPoints:[],loadChart:function(){if(_.map(chartFactory.getRequiredProperties(scope.chartProperties),function(prop){return scope.chartProperties[prop]}).indexOf(void 0)>-1)return scope.states.needAttrs=!0,void(scope.states.chart||(scope.states.chart=createHighchart({chart:{renderTo:scope.chartId},exporting:{enabled:!1},title:{text:""},data:[]})));scope.beforeRender(),scope.states.needAttrs=!1;var opts=chartFactory.getHighchartOptions(scope);opts.chart.renderTo=scope.chartId,scope.states.chart=createHighchart(opts),scope.chartTitle&&scope.states.chart.setTitle({text:scope.chartTitle}),_.each(scope.getSelectedRowsData(),function(datum){scope.apiHandle.api.togglePoint(datum[scope.key],!0)}),scope.afterRender()},addAdHocSeries:function(seriesOptions){var ser=scope.states.chart.addSeries(seriesOptions),foundIndex=_.findIndex(scope.states.adHocSeriesOptions,{id:seriesOptions.id});return ser&&foundIndex>-1?scope.states.adHocSeriesOptions[foundIndex]=angular.copy(seriesOptions):ser&&scope.states.adHocSeriesOptions.push(angular.copy(seriesOptions)),ser&&dhc.attachLegendEventHandlers(ser,scope),ser},removeAdHocSeries:function(seriesId){var series=scope.states.chart.get(seriesId);const index=_.findIndex(scope.states.adHocSeriesOptions,function(opt){return series?series.options.id===opt.id:void 0});return index>-1&&scope.states.adHocSeriesOptions.splice(index,1),series&&series.remove(),!!series},removeAllAdHocSeries:function(){const ids=_.pluck(scope.states.adHocSeriesOptions,"id");_.each(ids,function(id){scope.apiHandle.api.removeAdHocSeries(id)}),scope.states.adHocSeriesOptions=[]},timeoutLoadChart:function(){$timeout(function(){scope.apiHandle.api.loadChart()})},changeChartTitle:function(title){scope.states.chart.setTitle({text:title})},changeAxisTitle:function(axis,title){"x"==axis?scope.states.chart.xAxis[0].setTitle({text:title}):"y"==axis&&scope.states.chart.yAxis[0].setTitle({text:title})},togglePoint:function(key,skipLoad){const point=scope.states.chart.get(key);point&&point.select(null,!0),skipLoad||"selected"!==scope.chartProperties.dataToShow||scope.apiHandle.api.loadChart()},getPointStatus:function(key){const point=scope.states.chart.get(key);return point?point.selected:point},getRelevantProperties:function(){return chartFactory.getRelevantProperties(scope.chartProperties)},resetExcludedPoints:function(){this.excludedPoints=[],scope.resetExcludedPointsCallback()||this.loadChart()},changeRegressionType:function(tag){scope.chartProperties.regression=tag,this.loadChart()},hardReflow:function(){var containerStyles=window.getComputedStyle(scope.states.chart.container);scope.states.chart.setSize(parseInt(containerStyles.width),parseInt(containerStyles.height))}},$timeout(function(){scope.apiHandle.api.loadChart(),scope.highchartDOMElem=$($("#"+scope.chartId).get()[0]),$(scope.highchartDOMElem).hover(null,function(){scope.$flexibleRemoveBtn.detach()})})},templateUrl:scriptFolder.endsWith("src/")?scriptFolder+"/templates/DecoratedHighCharts.html":"DecoratedHighCharts.html"}}).directive("dhcClickOutside",function(){return{restrict:"A",scope:{openState:"=dhcOpenState",closeCallback:"&dhcCloseCallback"},link:function(scope,element){var clickedOutside=!0;const documentClickHandler=function(){clickedOutside&&scope.openState&&scope.closeCallback(),clickedOutside=!0};$(document).click(documentClickHandler);const elementClickHandler=function(){clickedOutside=!1};element.click(elementClickHandler),scope.$on("$destroy",function(){$(document).unbind("click",documentClickHandler),element.unbind("click",elementClickHandler)})}}});var TURBO_THRESHOLD=2e3;angular.module("decorated-high-charts").factory("chartFactory",function(boxPlotProvider,scatteredChartProvider,pieChartProvider,columnChartProvider){var chartFactoryMap={"Box Plot":boxPlotProvider,"Scattered Plot":scatteredChartProvider,"Pie Chart":pieChartProvider,"Column Chart":columnChartProvider};return{getSpecificChartService:function(chartType){return chartFactoryMap[chartType]},getHighchartOptions:function(chartScope){return chartFactoryMap[chartScope.chartProperties.type].produceChartOption(chartScope.chartProperties,chartScope,"all"!==chartScope.chartProperties.dataToShow)},getRelevantProperties:function(chartProperties){return"Pie Chart"===chartProperties.type||"Box Plot"===chartProperties.type?["group_by","analytic"]:"Scattered Plot"===chartProperties.type?["x_attribute","y_attribute","radius","group_by"]:"Column Chart"===chartProperties.type?["x_attribute","y_attribute","group_by"]:void 0},getRequiredProperties:function(chartProperties){return"Pie Chart"===chartProperties.type||"Box Plot"===chartProperties.type?["group_by","analytic"]:"Scattered Plot"===chartProperties.type||"Column Chart"===chartProperties.type?["x_attribute","y_attribute"]:void 0},regressionTypes:[{tag:"linear",text:"Linear"},{tag:"polynomial",text:"Polynomial"},{tag:"logarithmic",text:"Logarithmic"},{tag:"exponential",text:"Exponential"}]}}),angular.module("decorated-high-charts").factory("pieChartProvider",function(commonHighchartConfig){return{produceChartOption:function(chartProperties,chartScope,onlyOnSelectedRows){var cfgTemplate=_.extend(_.clone(commonHighchartConfig(chartScope)),{chart:{type:"pie",marginTop:40,height:chartScope.states.chart?chartScope.states.chart.chartHeight:void 0,width:chartScope.states.chart?chartScope.states.chart.chartWidth:void 0},plotOptions:{pie:{dataLabels:{formatter:function(){return"null"==this.point.name?"N/A":this.point.name}}}},tooltip:{formatter:function(){return"<b>"+this.series.name+"</b>: "+this.point.name+"<br/><b>Percent of Pie</b>: "+numeral(this.percentage).format("0,0.00")+"%<br/><b>Total for Slice</b>: "+numeral(this.y/1e3).format("0,0")+"<br/><b>Total for Pie</b>: "+numeral(this.total/1e3).format("0,0")},pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f} %",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}}}}),toGroupBy=chartProperties.group_by.colTag,groupedAnalytic=_.groupBy(getValidDataScope(onlyOnSelectedRows,chartScope),toGroupBy),categories=_.keys(groupedAnalytic),pieSeries=[],data=[];_.each(categories,function(category){var value=aggregate(groupedAnalytic[category],chartProperties.analytic),dataPoint={name:category,y:value};data.push(dataPoint)}),pieSeries.push({name:chartProperties.group_by.text,data:data});var cfg=_.clone(cfgTemplate);return categories.length<10?cfg.series=pieSeries:cfg.subtitle={text:"* Too Many Slices of Pie to Display from Grouping by "+chartProperties.group_by.text+" *"},cfg.title.text=chartProperties.group_by.text+" weighted by "+chartProperties.analytic.text,cfg}}}),angular.module("decorated-high-charts").factory("boxPlotProvider",function(commonHighchartConfig){return{produceChartOption:function(chartProperties,chartScope,onlyOnSelectedRows){var cfgTemplate=_.extend(_.clone(commonHighchartConfig(chartScope)),{chart:{type:"boxplot",marginTop:40,height:chartScope.states.chart?chartScope.states.chart.chartHeight:void 0,width:chartScope.states.chart?chartScope.states.chart.chartWidth:void 0},title:{text:null},tooltip:{valueDecimals:2},legend:{enabled:!1},plotOptions:{},xAxis:{labels:{formatter:function(){return"null"==this.value?"N/A":this.value}}},yAxis:{title:{text:null}},series:null,credits:{enabled:!1}}),toGroupBy=chartProperties.group_by.colTag,analytic=chartProperties.analytic.colTag,groupedAnalytic=_.groupBy(getValidDataScope(onlyOnSelectedRows,chartScope),toGroupBy),categories=_.keys(groupedAnalytic),boxPlotData=[];_.each(categories,function(category){var data=_.pluck(groupedAnalytic[category],analytic);boxPlotData.push([ss.min(data),ss.quantile(data,.25),ss.median(data),ss.quantile(data,.75),ss.max(data)])});var boxPlotSeries={name:chartProperties.analytic.text,data:boxPlotData},cfg=_.clone(cfgTemplate);return cfg.xAxis.categories=categories,cfg.xAxis.title=cfg.xAxis.title?cfg.xAxis.title:{},cfg.xAxis.title.text=chartProperties.group_by.text,cfg.yAxis.title.text=chartProperties.analytic.text,categories.length<15?cfg.series=[boxPlotSeries]:cfg.subtitle={text:"* Too Many Boxes to Display from Grouping by "+chartProperties.group_by.text+" *"},cfg.title.text=chartProperties.analytic.text+" by "+chartProperties.group_by.text,cfg}}}),angular.module("decorated-high-charts").factory("scatteredChartProvider",function(dhcStatisticalService,commonHighchartConfig,dhcSeriesColorService,$timeout){function generateSeries(categories,radius,groupedData,xAttr,yAttr,stdevForOutlierRemoval,chartScope,propertiesHash){var series=[];return _.each(categories,function(category){var data=[];null!=radius?_.each(groupedData[category],function(item){null!=item[xAttr.colTag]&&item[yAttr.colTag]&&-1==chartScope.apiHandle.api.excludedPoints.indexOf(item[chartScope.key])&&data.push({id:item[chartScope.key],name:item[chartScope.key],x:item[xAttr.colTag],y:item[yAttr.colTag],z:item[radius.colTag]})}):_.each(groupedData[category],function(item){null!=item[xAttr.colTag]&&item[yAttr.colTag]&&-1==chartScope.apiHandle.api.excludedPoints.indexOf(item[chartScope.key])&&data.push({id:item[chartScope.key],name:item[chartScope.key],x:item[xAttr.colTag],y:item[yAttr.colTag]})}),data=data.sort(function(a,b){return a.x-b.x});var result=processData(chartScope.data,stdevForOutlierRemoval,xAttr,yAttr),serObj={name:"null"==category?"Not Found":category,tooltip:{pointFormat:'<span style="color:{series.color}">{point.name}</span><br/><b>'+xAttr.text+"</b>: {point.x:,.2f} <br/><b>"+yAttr.text+"</b>: {point.y:,.2f}<br/><br/><b>"+xAttr.text+" &mu;</b>:"+numeral(result.xMean.toFixed(2)).format("0,0.00")+"<br/><b>"+yAttr.text+" &mu;</b>:"+numeral(result.yMean.toFixed(2)).format("0,0.00")+"<br/><br/><b>"+xAttr.text+" &sigma;</b>:"+numeral(result.xStdev.toFixed(2)).format("0,0.00")+"<br/><b>"+yAttr.text+" &sigma;</b>:"+numeral(result.yStdev.toFixed(2)).format("0,0.00")},data:data,marker:{symbol:"circle",states:{select:{lineColor:null}}},color:null};const seriesColor=dhcSeriesColorService.getOrAssign("chart"+propertiesHash,serObj.name);serObj.color=seriesColor,serObj.marker.states.select.lineColor=seriesColor,serObj.data.length>0&&series.push(serObj)}),series}function addFittedLine(series,chartId){var index=0;return _.each(series,function(currentSeries){var regressionOutput=dhcStatisticalService.getLinearFit(currentSeries.data),color=dhcSeriesColorService.get("chart"+chartId,currentSeries.name);series.push({name:currentSeries.name+" Regression (Linear)",marker:{enabled:!1},type:"line",showInLegend:!1,enableMouseTracking:!1,color:color,data:regressionOutput.predictedValue}),index++}),series}function regressionJSWrapper(series,type,extraArgs,chartId){var index=0;return _.each(series,function(currentSeries){if(!(currentSeries.data.length<=1)){var regressionOutput=dhcStatisticalService.regressionJSWrapper(currentSeries.data,type,extraArgs),color=dhcSeriesColorService.get("chart"+chartId,currentSeries.name);series.push({name:currentSeries.name+" Regression ("+type+")",marker:{enabled:!1},type:"spline",showInLegend:!1,enableMouseTracking:!1,color:color,data:regressionOutput.predictedValue}),index++}}),series}function processData(data,stdevForOutlierRemoval,xAttr,yAttr){var filteredData,yData=_.chain(data).pluck(yAttr.colTag).compact().value(),xData=_.chain(data).pluck(xAttr.colTag).compact().value(),xMean=ss.mean(xData),xStdev=ss.standard_deviation(xData),yMean=ss.mean(yData),yStdev=ss.standard_deviation(yData);return filteredData=stdevForOutlierRemoval?_.filter(data,function(datum){var xCutoff=Math.abs(xMean-datum[xAttr.colTag]),yCutoff=Math.abs(yMean-datum[yAttr.colTag]);return stdevForOutlierRemoval*xStdev>xCutoff&&stdevForOutlierRemoval*yStdev>yCutoff}):data,{data:filteredData,xMean:xMean||0,yMean:yMean||0,xStdev:xStdev||0,yStdev:yStdev||0}}return{addRegression:function(series,type,extraArgs,id){return type?regressionJSWrapper(series,type,extraArgs,id):addFittedLine(series,id)},removeRegression:function(series){for(var i=0;i<series.chart.series.length;i++)if(series.color==series.chart.series[i].color&&series.chart.series[i].name.match("Regression")){series.chart.series[i].remove();break}},redrawRegression:function(series,chartProperties){if(this.removeRegression(series),series.data.length>1)if("linear"===chartProperties.regression){var regressionOutput=dhcStatisticalService.getLinearFit(series.data),color=dhcSeriesColorService.get("chart"+chartProperties.$$hashKey,series.name);series.chart.addSeries({name:series.name+" Regression (Linear)",marker:{enabled:!1},type:"line",showInLegend:!1,enableMouseTracking:!1,color:color,data:regressionOutput.predictedValue})}else if(null!=chartProperties.regression&&""!=chartProperties.regression){var extraArg="polynomial"===chartProperties.regression?chartProperties.regression_degree:null,regressionOutput=dhcStatisticalService.regressionJSWrapper(series.data,chartProperties.regression,extraArg),color=dhcSeriesColorService.get("chart"+chartProperties.$$hashKey,series.name);series.chart.addSeries({name:series.name+" Regression ("+chartProperties.regression+")",marker:{enabled:!1},type:"spline",showInLegend:!1,enableMouseTracking:!1,color:color,data:regressionOutput.predictedValue})}},produceChartOption:function(chartProperties,chartScope,onlyOnSelectedRows){var cfgTemplate=_.extend(_.clone(commonHighchartConfig(chartScope)),{chart:{type:"scatter",zoomType:"xy",marginTop:10,height:chartScope.states.chart?chartScope.states.chart.chartHeight:void 0,width:chartScope.states.chart?chartScope.states.chart.chartWidth:void 0},legend:{enabled:!0},series:[],credits:{enabled:!1}}),obj=this;dhcSeriesColorService.removePalate("chart"+chartProperties.$$hashKey);var xAttr=chartProperties.x_attribute,yAttr=chartProperties.y_attribute,radius=chartProperties.radius,groupByAttr=chartProperties.group_by,series=[],cfg=_.clone(cfgTemplate),groupedData={};if(getValidDataScope(onlyOnSelectedRows,chartScope).length<=TURBO_THRESHOLD){var result=processData(getValidDataScope(onlyOnSelectedRows,chartScope),chartProperties.outlier_remove,xAttr,yAttr),data=result.data;null!=groupByAttr?groupedData=_.groupBy(data,groupByAttr.colTag):groupedData[chartProperties.x_attribute.text]=data;var categories=_.keys(groupedData);if(series=generateSeries.call(this,categories,radius,groupedData,xAttr,yAttr,chartProperties.outlier_remove,chartScope,chartProperties.$$hashKey),"linear"===chartProperties.regression)addFittedLine(series,chartProperties.$$hashKey);else if(null!=chartProperties.regression&&""!=chartProperties.regression){var extraArg="polynomial"===chartProperties.regression?chartProperties.regression_degree:null;regressionJSWrapper(series,chartProperties.regression,extraArg,chartProperties.$$hashKey)}}else cfg.subtitle={text:"* Too Many Data Points to Plot - (Future Versions will Implement Random Sampling and Drilldown Features) *"};return null!=radius?cfg.chart.type="bubble":cfg.chart.type="scatter",series.length>10?cfg.subtitle={text:"* Too Many Series to Plot *"}:cfg.series=series,cfg.legend.enabled=_.reject(series,function(ser){return"spline"===ser.type}).length>1,chartScope.chartOptions&&chartScope.chartOptions.alwaysEnableLegend&&(cfg.legend.enabled=!0),cfg.xAxis.title.text=xAttr.text,cfg.yAxis.title.text=yAttr.text,cfg.title.text=xAttr.text+" vs. "+yAttr.text,cfg.plotOptions={series:{events:{legendItemClick:function(){var thisRe=new RegExp("^"+this.name+" Regression");return _.each(this.chart.series,function(ser){ser.name.match(thisRe)&&(ser.visible?ser.hide():ser.show())}),!0}},point:{events:{click:function(e){e.stopPropagation(),chartScope.scatterPlotPointClickCallback({point:this})&&chartScope.apiHandle.api.togglePoint(this.id)},mouseOver:function(){const point=this;chartScope.$flexibleRemoveBtn.detach(),chartScope.$flexibleRemoveBtn.off("click"),chartScope.$flexibleRemoveBtn.on("click",function(){$timeout(function(){if(point.id&&-1==chartScope.apiHandle.api.excludedPoints.indexOf(point.id)){chartScope.apiHandle.api.excludedPoints.push(point.id);const series=point.series;if(chartScope.pointRemovalCallback({point:point}),point&&point.remove&&point.remove(),series&&series.options){const isAPointInAdHocSeries=_.reduce(chartScope.states.adHocSeriesOptions,function(memo,ser){return memo||ser.id===series.options.id},!1);isAPointInAdHocSeries||obj.redrawRegression(series,chartProperties)}}chartScope.$flexibleRemoveBtn.detach()})}),chartScope.$flexibleRemoveBtn.css({top:this.series.chart.yAxis[0].toPixels(this.y)-15+"px",left:this.series.chart.xAxis[0].toPixels(this.x)+"px"}),chartScope.$flexibleRemoveBtn.appendTo($(chartScope.highchartDOMElem))}}}}},cfg.tooltip.hideDelay=0,chartProperties.show_datalabel?cfg.plotOptions[cfg.chart.type]={dataLabels:{allowOverlap:!1,enabled:!0,formatter:function(){return this.point.name}}}:delete cfg.plotOptions[cfg.chart.type],cfg}}}),angular.module("decorated-high-charts").factory("commonHighchartConfig",function(){function getCommonCfg(chartScope){return _.extend({chart:{animation:!1,marginTop:-12},title:{text:"",events:{click:function(e){e.preventDefault(),e.stopPropagation(),dhc.onTitleClick(e,chartScope,this)}}},plotOptions:{series:{turboThreshold:TURBO_THRESHOLD}},exporting:{enabled:!1},tooltip:{valueDecimals:2,useHTML:!0,delayForDisplay:1e3},credits:{enabled:!1},xAxis:{title:{events:{click:function(event){dhc.onAxisClick.call(this,event,chartScope)}}}},yAxis:{title:{events:{click:function(event){dhc.onAxisClick.call(this,event,chartScope)}}}}},chartScope.chartOptions.highchartsOverlay?chartScope.chartOptions.highchartsOverlay:{})}return $.extend(Highcharts.Renderer.prototype.symbols,{X:function(a,b,c,d){return["M",a,b,"L",a+c,b+d,"M",a+c,b,"L",a,b+d]}}),function(chartScope){return _.clone(getCommonCfg(chartScope))}}),angular.module("decorated-high-charts").factory("columnChartProvider",function(commonHighchartConfig){return{produceChartOption:function(chartProperties,chartScope,onlyOnSelectedRows){var cfgTemplate=_.extend(_.clone(commonHighchartConfig(chartScope)),{chart:{type:"column",height:chartScope.states.chart?chartScope.states.chart.chartHeight:void 0,width:chartScope.states.chart?chartScope.states.chart.chartWidth:void 0},xAxis:{title:{text:null},showEmpty:!1},yAxis:{title:{text:null},showEmpty:!1},plotOptions:{column:{pointPadding:.2,borderWidth:0}}});cfgTemplate.chart.height=chartScope.states.chart?chartScope.states.chart.chartHeight:void 0,cfgTemplate.chart.width=chartScope.states.chart?chartScope.states.chart.chartWidth:void 0;var x=chartProperties.x_attribute,y=chartProperties.y_attribute,groupedAnalytic={};chartProperties.group_by?groupedAnalytic=_.groupBy(getValidDataScope(onlyOnSelectedRows,chartScope),chartProperties.group_by.colTag):groupedAnalytic[x.text]=getValidDataScope(onlyOnSelectedRows,chartScope);var categories=_.keys(groupedAnalytic),xValues=_.uniq(_.pluck(getValidDataScope(onlyOnSelectedRows,chartScope),x.colTag)),series=[];_.each(categories,function(category){var categoryData=groupedAnalytic[category],data=_.map(xValues,function(xValue){var toAggregate=_.filter(categoryData,function(item){return item[x.colTag]==xValue});return aggregate(toAggregate,y)});category="null"==category?"N/A "+chartProperties.group_by.text:category,series.push({name:category,data:data})});var cfg=_.clone(cfgTemplate);return categories.length*series.length<50?cfg.series=series:cfg.subtitle={text:"* Too Many Bars to Display *"},xValues=_.map(xValues,function(item){return null==item?"N/A "+chartProperties.x_attribute.text:item}),cfg.xAxis.categories=xValues,cfg.xAxis.title=cfg.xAxis.title?cfg.xAxis.title:{},cfg.xAxis.title.text=chartProperties.x_attribute.text,cfg.yAxis.title.text=chartProperties.y_attribute.text,cfg.title.text=y.text+" by "+x.text,cfg.legend=cfg.legend||{},cfg.legend.enabled=series.length>1,cfg}}}),angular.module("decorated-high-charts").factory("dhcSeriesColorService",function(){const colors=["#0079C1","#009A3D","#6C207E","#E31B23","#F8971D","#FFD200","#59BD81","#59A7D7","#9F6FAA","#ED6B70","#FABB6B","#FFE159","#325CBA","#3CB54B","#092A59","#BB4B31","#32A0BA","#B98F2F","#849DD0","#8DCC92","#6C809C","#85C6D5","#D69383","#D5BC81","#C9D4ED","#ADBEE2","#B3DBB6","#787878","#9DAABD","#ADD9E3","#E4B7AD","#E3D3AC","#A1B5DD","#D8ECDA","#555555","#CEBDDE","#D6ECF1","#F1DBD5","#5474B9"];return{palate:colors,altPalate:angular.copy(colors).reverse(),fullPalate:{},get:function(palateName,key){return this.fullPalate[palateName]&&this.fullPalate[palateName][key]?this.fullPalate[palateName][key]:null},put:function(palateName,key,color){this.fullPalate[palateName]||(this.fullPalate[palateName]={}),this.fullPalate[palateName][key]=color},remove:function(palateName,key){this.fullPalate[palateName]&&this.fullPalate[palateName][key]&&delete this.fullPalate[palateName][key]},removePalate:function(palateName){this.fullPalate[palateName]&&delete this.fullPalate[palateName]},assign:function(palateName,key,useAltPalate){this.fullPalate[palateName]||(this.fullPalate[palateName]={});const palateToUse=useAltPalate?this.altPalate:this.palate;var indexToUse=Object.keys(this.fullPalate[palateName]).length;return this.put(palateName,key,palateToUse[indexToUse%palateToUse.length]),palateToUse[indexToUse]},getOrAssign:function(palateName,key,useAltPalate){var color=this.get(palateName,key);return color?color:this.assign(palateName,key,useAltPalate)},resetPalate:function(){this.fullPalate={}}}}),angular.module("decorated-high-charts").factory("dhcStatisticalService",function(){return{getLinearFit:function(data){var dataArray=_.map(data,function(point){return[point.x,point.y]});if(0!=dataArray.length){var regression=ss.linear_regression().data(dataArray),cols=_.zip.apply(_,dataArray),correlation=ss.sample_correlation(cols[0],cols[1]),linearFn=regression.line(),predictedValue=_.map(dataArray,function(pt){return[pt[0],linearFn(pt[0])]});return{predictedValue:predictedValue,beta:regression.m(),intercept:regression.b(),correlation:correlation}}return{predictedValue:[],beta:0,intercept:0,correlation:0}},regressionJSWrapper:function(data,type,extraArg){var dataArray=_.map(data,function(datum){return[datum.x,datum.y]});if(0!=dataArray.length){const scrubbedData=_.filter(dataArray,function(row){return row[0]&&row[0]});var regressionOutput=regression(type,scrubbedData,extraArg),predictedValue=regressionOutput.points;return predictedValue.sort(function(a,b){return a[0]-b[0]}),{predictedValue:predictedValue,equation:regressionOutput.string}}return{predictedValue:[],equation:""}}}}),function(){function extractHtmlFromScatter(chart){var headers="",body="";headers="<tr>"+_.map(chart.series,function(ser){return"<th colspan='2' style='background-color: #0069d6; color: #ffffff;'>"+ser.name+"</th>"}).join("")+"</tr>",headers+="<tr>"+_.map(chart.series,function(){return"<th style='background-color: #7fb4ea;'>"+chart.options.xAxis[0].title.text+" (x)</th><th style='background-color: #7fb4ea;'>"+chart.options.yAxis[0].title.text+" (y)</th>"}).join("")+"</tr>";const maxLength=_.chain(chart.series).map(function(ser){return ser.data.length}).value().sort(function(a,b){return b-a})[0];return body=_(maxLength).times(function(index){var row="<tr>";return row+=_.map(chart.series,function(ser){var cellX="<td>"+(ser.data.length>index?ser.data[index].x:"")+"</td>",cellY="<td>"+(ser.data.length>index?ser.data[index].y:"")+"</td>";return cellX+cellY}).join(""),row+="</tr>"}).join(""),headers+body}function extractHtmlFromColumn(chart){var headers="<tr><th style='background-color: #0069d6; color: #ffffff;'></th>"+_.map(chart.series,function(ser){return"<th style='background-color: #0069d6; color: #ffffff;'>"+ser.name+"</th>"}).join("")+"</tr>",body=_.map(chart.xAxis[0].categories,function(category){var cells="<td>"+category+"</td>";return cells+=_.map(chart.series,function(ser){var foundCategory=_.findWhere(ser.data,{category:category});return"<td>"+(foundCategory&&foundCategory.y?foundCategory.y:"")+"</td>"}).join(""),"<tr>"+cells+"</tr>"}).join("");return headers+body}function extractHtmlFromPie(chart){var groupingBy=chart.options.title.text.split(" weighted by ")[1],headers="<tr><th style='background-color: #0069d6; color: #ffffff;'>"+chart.series[0].name+"</th><th style='background-color: #0069d6; color: #ffffff;'>"+groupingBy+"%</th><th style='background-color: #0069d6; color: #ffffff;'>Total "+groupingBy+"</tr>",body=_.map(chart.series[0].data,function(datum){var cells="<td>"+datum.name+"</td>";return cells+="<td>"+datum.percentage+"</td>",cells+="<td>"+datum.y+"</td>","<tr>"+cells+"</tr>"}).join("");return headers+body}function extractHtmlFromBoxPlot(chart){var headers="<tr><th style='background-color: #0069d6; color: #ffffff;'>"+chart.options.xAxis[0].title.text+"</th><th style='background-color: #0069d6; color: #ffffff;'>"+chart.options.yAxis[0].title.text+" Low</th><th style='background-color: #0069d6; color: #ffffff;'>"+chart.options.yAxis[0].title.text+" Q1</th><th style='background-color: #0069d6; color: #ffffff;'>"+chart.options.yAxis[0].title.text+" Median</th><th style='background-color: #0069d6; color: #ffffff;'>"+chart.options.yAxis[0].title.text+" Q3</th><th style='background-color: #0069d6; color: #ffffff;'>"+chart.options.yAxis[0].title.text+" High</th>",body=_.map(chart.series[0].data,function(datum){var cells="<td>"+datum.category+"</td>";return cells+="<td>"+datum.low+"</td>",cells+="<td>"+datum.q1+"</td>",cells+="<td>"+datum.median+"</td>",cells+="<td>"+datum.q3+"</td>",cells+="<td>"+datum.high+"</td>","<tr>"+cells+"</tr>"}).join("");return headers+body}const root=this,dhc=root.dhc||{};root.dhc=dhc,dhc.chartToHTML=function(chart){var html="";if(chart.series.length>0)switch(chart.options.chart.type){case"scatter":html=extractHtmlFromScatter(chart);break;case"column":html=extractHtmlFromColumn(chart);break;case"pie":html=extractHtmlFromPie(chart);break;case"boxplot":html=extractHtmlFromBoxPlot(chart)}return"<table>"+html+"</table>"}}(),function(){const root=this,dhc=root.dhc||{};root.dhc=dhc,root.dhc.resolvePreferredYAxis=function(chart,seriesOption){return seriesOption.axisType?_.findIndex(chart.yAxis,function(axis){return axis.userOptions.axisType===seriesOption.axisType}):0===chart.yAxis.length?-1:0},root.dhc.addAxisToChart=function(chart,name,scope,axisType){const axisId=_.uniqueId("yAxis");return chart.addAxis({title:{text:name,events:{click:function(event){dhc.onAxisClick.call(this,event,scope)}}},axisType:axisType,opposite:chart.axes.length%2==0,id:axisId}),chart.get(axisId)},root.dhc.attachLegendEventHandlers=function(series,scope){series.legendItem&&series.legendItem.element&&$(series.legendItem.element).css({"user-select":"none"}).mousedown(function(event){return 2==event.button?(event.preventDefault(),event.stopPropagation(),dhc.triggerSeriesContextMenu(event,{series:series,scope:scope})):void 0})},root.dhc.onAxisClick=function(event,scope){function editAxisTitle(){const $input=$("<input type='text' class='form-control' style='position:relative; left: 10%; width: 80%;'/>");$input.val(axis.axisTitle.textStr),$input.on("keydown",function(keyEvent){13==keyEvent.keyCode&&""!=$input.val()&&(keyEvent.preventDefault(),keyEvent.stopPropagation(),axis.setTitle({text:$input.val()}),$ctxMenu.hide())});const $menuItem=$("<li><span></span></li>").click(dhc.inertClickHandler);return $menuItem.children("span").append($input),$menuItem}event.preventDefault(),event.stopPropagation();const axis=this,$ctxMenu=scope.$ctxMenu;$ctxMenu.find(".dropdown-menu li").remove(),$ctxMenu.children(".dropdown-menu").append(editAxisTitle()),
dhc.showCtxMenu($ctxMenu,event),$ctxMenu.find("input.form-control").select()},root.dhc.showCtxMenu=function($ctxMenu,event){$ctxMenu.show();const $rootDiv=$("div.root"),ctnRight=$rootDiv.position().left+$rootDiv.width(),menuRight=event.clientX+$ctxMenu.children().width(),ctnBtm=$rootDiv.position().top+$rootDiv.height(),menuBtm=event.clientY+$ctxMenu.children().height();var left=event.clientX;menuRight>ctnRight&&(left=Math.max(event.clientX-$ctxMenu.children().width(),0));var top=event.clientY;menuBtm>ctnBtm&&(top=event.clientY-$ctxMenu.children().height()),$ctxMenu.css({top:top+"px",left:left+"px"})},root.dhc.inertClickHandler=function(e){e.preventDefault(),e.stopPropagation()},root.dhc.moveAxis=function(series,targetAxis,scope){const origAxis=series.yAxis,seriesOptions=series.options;seriesOptions.yAxis=_.findIndex(scope.states.chart.yAxis,function(x){return x.userOptions.id==targetAxis.userOptions.id}),seriesOptions.color=series.color,series.remove(),scope.addSeries(seriesOptions),dhc.isAxisEmpty(origAxis)&&origAxis.remove()},root.dhc.generateSeriesID=function(security,attr){return["Security",security.id,attr.tag].join(".")},root.dhc.onTitleClick=function(clickEvent,scope,chart){const $input=$("<input class='form-control' style='position:relative; left: 5%; width: 90%;'/>"),$menuItem=$("<li><span></span></li>");$menuItem.on("click",dhc.inertClickHandler).children("span").append($input);const $ctxMenu=scope.$ctxMenu;$ctxMenu.find(".dropdown-menu li").remove(),$ctxMenu.children(".dropdown-menu").append($menuItem),$input.on("keydown",function(keyEvent){13==keyEvent.keyCode&&""!=$input.val()?(keyEvent.preventDefault(),keyEvent.stopPropagation(),chart.setTitle({text:$input.val()}),$ctxMenu.hide()):27==keyEvent.keyCode&&$ctxMenu.hide()}).val(chart.options.title.text);const titleLength=Math.min($input.val().length,20);$menuItem.css({"min-width":titleLength+"em"}),dhc.showCtxMenu($ctxMenu,clickEvent),$input.select()},root.dhc.isAxisEmpty=function(yAxis){return yAxis&&0===yAxis.series.length},root.dhc.afterSeriesRemove=function(securityId,scope){},root.dhc.removeSeriesById=function(id,scope){const chart=scope.states.chart,series=chart.get(id),yAxis=series.yAxis,securityId=series.options.securityId;angular.isFunction(series.remove)&&series.remove(),dhc.afterSeriesRemove(yAxis,securityId,scope)},root.dhc.SMAFactory=function(period){var nums=[];return function(num){nums.push(num),nums.length>period&&nums.splice(0,1);var sum=0;for(var i in nums)sum+=nums[i];var n=period;return nums.length<period&&(n=nums.length),sum/n}}}(),function(){const root=this,dhc=root.dhc||{};root.dhc=dhc,root.dhc.buildContextMenuContainer=function(elem){const $ctxMenu=$("<div style='z-index: 10; position: fixed;'><ul class='clickable dropdown-menu multi-level' style='display: block;'></ul></div>").hide();return $ctxMenu.prependTo(elem.children(".root")),$(window).click(function(){$ctxMenu.hide()}),$ctxMenu},root.dhc.triggerSeriesContextMenu=function(event,args){const $ctxMenu=args.scope.$ctxMenu;return $ctxMenu.find(".dropdown-menu li").remove(),_.each(dhc.buildMenuItems(args),function(menuItem){$ctxMenu.children(".dropdown-menu").append(menuItem)}),dhc.showCtxMenu($ctxMenu,event),!1},root.dhc.buildMenuItems=function(args){const scope=args.scope,series=(scope.seriesTransformer,args.series),disableTransformation=series.options.disableFurtherTransformation,removeSeries=(scope.states.chart,function(){return $("<li><a>Remove</a></li>").click(function(){scope.$apply(function(){scope.removeSeries(series)})})});return disableTransformation?[removeSeries()]:[removeSeries()]},root.dhc.buildSeriesSubMenu=function(args){const chart=args.scope.states.chart,callback=args.onClick,currentSeries=args.currentSeries,$subMenu=$("<ul class='dropdown-menu'></ul>"),filteredSeries=_.filter(chart.series,function(series){return currentSeries&&series.options.id!==currentSeries.options.id});return 0==filteredSeries.length?$subMenu.append("<li><a>No Other Series to Compare To</a></li>"):_.each(filteredSeries,function(series){$("<li><a>"+series.name+"</a></li>").click(function(event){callback(event,series)}).appendTo($subMenu)}),$subMenu},root.dhc.buildAxesSubMenu=function(series,chart,scope){const $dropdown=$("<ul class='dropdown-menu'></ul>");return _.each(chart.yAxis,function(axis){var $menuItem;$menuItem=axis.userOptions.id===series.yAxis.userOptions.id?$("<li><a>Y-Axis: "+axis.options.title.text+"&nbsp;<i class='fa fa-check'></i></a></li>"):$("<li><a>Y-Axis: "+axis.options.title.text+"</a></li>").click(function(){dhc.moveAxis(series,axis,scope)}),$dropdown.append($menuItem)}),$dropdown.append($('<li><a><i class="fa fa-plus"></i> Move To New Axis</a></li>').click(function(){const axis=dhc.addAxisToChart(chart,series.name,scope,series.userOptions.axisType);dhc.moveAxis(series,axis,scope)})),$dropdown}}(),angular.module("decorated-high-charts").run(["$templateCache",function($templateCache){$templateCache.put("DecoratedHighCharts.html",'<div class="root" style="position: relative;height:100%">\r\n    <div class="control flex-main-container">\r\n        <span class="flex-sub-container-left">\r\n            <span ng-hide="chartOptions.disablePropertyChooser">\r\n                <span ng-if="chartProperties.type == \'Scattered Plot\'">\r\n                    <div class="restrict-dropdown-menu" ng-hide="chartOptions.disableFirstProperty">\r\n                        <label>X:</label>\r\n                        <input type="text" ng-model="chartProperties.x_attribute" class="form-control"\r\n                               style="width: 12em; display: inline; height:25px;"\r\n                               placeholder="Enter attribute"\r\n                               typeahead="column as column.text for column in getValidColumns(numericalColumns) | filter:$viewValue:$emptyOrMatch | orderBy:\'text.toString()\'"\r\n                               typeahead-focus\r\n                               typeahead-on-select="apiHandle.api.loadChart()"\r\n                               typeahead-select-on-blur="true"/>\r\n                    </div>\r\n                    <div class="restrict-dropdown-menu" ng-hide="chartOptions.disableSecondProperty">\r\n                        <label>Y:</label>\r\n                        <input type="text" ng-model="chartProperties.y_attribute" class="form-control"\r\n                               style="width: 12em; display: inline; height:25px;"\r\n                               placeholder="Enter attribute"\r\n                               typeahead="column as column.text for column in getValidColumns(numericalColumns) | filter:$viewValue:$emptyOrMatch | orderBy:\'text.toString()\'"\r\n                               typeahead-focus\r\n                               typeahead-on-select="apiHandle.api.loadChart()"\r\n                               typeahead-select-on-blur="true"/>\r\n                    </div>\r\n                </span>\r\n                <span ng-if="chartProperties.type == \'Column Chart\'">\r\n                    <div class="restrict-dropdown-menu" ng-hide="chartOptions.disableFirstProperty">\r\n                        <label>X:</label>\r\n                        <input type="text" ng-model="chartProperties.x_attribute" class="form-control"\r\n                               style="width: 12em; display: inline; height:25px;"\r\n                               placeholder="Enter attribute"\r\n                               typeahead="column as column.text for column in getValidColumns(categoricalColumns) | filter:$viewValue:$emptyOrMatch | orderBy:\'text.toString()\'"\r\n                               typeahead-focus\r\n                               typeahead-on-select="apiHandle.api.loadChart()"\r\n                               typeahead-select-on-blur="true"/>\r\n                    </div>\r\n                    <div class="restrict-dropdown-menu" ng-hide="chartOptions.disableSecondProperty">\r\n                        <label>Y:</label>\r\n                        <input type="text" ng-model="chartProperties.y_attribute" class="form-control"\r\n                               style="width: 12em; display: inline; height:25px;"\r\n                               placeholder="Enter attribute"\r\n                               typeahead="column as column.text for column in getValidColumns(numericalColumns) | filter:$viewValue:$emptyOrMatch | orderBy:\'text.toString()\'"\r\n                               typeahead-focus\r\n                               typeahead-on-select="apiHandle.api.loadChart()"\r\n                               typeahead-select-on-blur="true"/>\r\n                    </div>\r\n                </span>\r\n                <span ng-if="chartProperties.type == \'Pie Chart\' || chartProperties.type == \'Box Plot\'">\r\n                    <div class="restrict-dropdown-menu" ng-hide="chartOptions.disableFirstProperty">\r\n                        <label>Summarize:</label>\r\n                        <input type="text" ng-model="chartProperties.analytic" class="form-control"\r\n                               style="width: 12em; display: inline; height:25px;"\r\n                               placeholder="Enter attribute"\r\n                               typeahead="column as column.text for column in getValidColumns(numericalColumns) | filter:$viewValue:$emptyOrMatch | orderBy:\'text.toString()\'"\r\n                               typeahead-focus\r\n                               typeahead-on-select="apiHandle.api.loadChart()"\r\n                               typeahead-select-on-blur="true"/>\r\n                    </div>\r\n                    <div class="restrict-dropdown-menu" ng-hide="chartOptions.disableSecondProperty">\r\n                        <label style="padding-right: 10px;">Group By:</label>\r\n                        <input type="text" ng-model="chartProperties.group_by" class="form-control"\r\n                               style="width: 12em; display: inline; height:25px;"\r\n                               placeholder="Enter attribute"\r\n                               typeahead="column as column.text for column in getValidColumns(categoricalColumns) | filter:$viewValue:$emptyOrMatch | orderBy:\'text.toString()\'"\r\n                               typeahead-focus\r\n                               typeahead-on-select="apiHandle.api.loadChart()"\r\n                               typeahead-select-on-blur="true"/>\r\n                    </div>\r\n                </span>\r\n            </span>\r\n            <span ng-hide="chartOptions.disableMoreOptions" dhc-click-outside dhc-open-state="states.menuDisplays.moreOptions"\r\n                              dhc-close-callback="toggleSlide(!states.menuDisplays.moreOptions,\'more-options\')">\r\n                <a class="clickable" style="text-decoration:none;padding-left:20px;"\r\n                   ng-click="toggleSlide(!states.menuDisplays.moreOptions,\'more-options\');selected=\'\';">\r\n                    <span class="fake-anchor-tag">More Options</span>\r\n                    <i class="fa" ng-class="{\'fa-chevron-up\': states.menuDisplays.moreOptions, \'fa-chevron-down\': !states.menuDisplays.moreOptions}"></i>\r\n                </a>\r\n                <div class="more-options floating-form" style="display: none;width:250px;">\r\n                    <div ng-if="chartProperties.type == \'Scattered Plot\'">\r\n                        <label style="padding-right: 10px;">Group By:</label>\r\n                        <div class="restrict-dropdown-menu input-group">\r\n                            <input type="text" class="form-control"\r\n                                   ng-model="chartProperties.group_by"\r\n                                   typeahead="column as column.text for column in getValidColumns(categoricalColumns) | filter:$viewValue:$emptyOrMatch | orderBy:\'text.toString()\'"\r\n                                   typeahead-on-select="apiHandle.api.loadChart()"\r\n                                   typeahead-focus/>\r\n                            <span class="dhc-clickable input-group-addon" ng-click="chartProperties.group_by = undefined;apiHandle.api.loadChart()">\r\n                                <strong>X</strong>\r\n                            </span>\r\n                        </div>\r\n                        <label>Radius:&nbsp;</label>\r\n                        <div class="restrict-dropdown-menu input-group">\r\n                            <input type="text" class="form-control"\r\n                                   ng-model="chartProperties.radius"\r\n                                   typeahead="column as column.text for column in getValidColumns(numericalColumns) | filter:$viewValue:$emptyOrMatch | orderBy:\'text.toString()\'"\r\n                                   typeahead-on-select="apiHandle.api.loadChart()"\r\n                                   typeahead-focus/>\r\n                            <span class="dhc-clickable input-group-addon" ng-click="chartProperties.radius = undefined;apiHandle.api.loadChart()">\r\n                                <strong>X</strong>\r\n                            </span>\r\n                        </div>\r\n                        <div>\r\n                            <label>Regression:&nbsp;</label>\r\n                            <br/>\r\n                            <div class="btn-group" dropdown>\r\n                                <button id="split-button" type="button" class="btn btn-default">{{getRegressionText()}}</button>\r\n                                <button type="button" class="btn btn-default" dropdown-toggle>\r\n                                    <span class="caret"></span>\r\n                                </button>\r\n                                <ul class="dropdown-menu" role="menu" aria-labelledby="split-button">\r\n                                    <li role="menuitem" ng-repeat="type in chartFactory.regressionTypes"\r\n                                        ng-click="apiHandle.api.changeRegressionType(type.tag)">\r\n                                        <a href="#">{{type.text}}</a>\r\n                                    </li>\r\n                                    <li role="menuitem" ng-click="apiHandle.api.changeRegressionType()">\r\n                                        <a href="#">None</a>\r\n                                    </li>\r\n                                </ul>\r\n                            </div>\r\n                            <div ng-show="chartProperties.regression == \'polynomial\'">\r\n                                <label>Regression Degree:</label>\r\n                                <input class="form-control" type="number" min="1" ng-model="chartProperties.regression_degree"\r\n                                       ng-change="apiHandle.api.timeoutLoadChart()"/>\r\n                            </div>\r\n                        </div>\r\n                        <br/>\r\n                        <div>\r\n                            <div>\r\n                                <input type="checkbox" ng-model="chartProperties.show_datalabel" ng-click="apiHandle.api.timeoutLoadChart()"/>\r\n                                Data Labels\r\n                            </div>\r\n                            <div style="padding-top:10px;">\r\n                                <input type="checkbox" ng-model="chartProperties.outlier_remove" ng-click="apiHandle.api.timeoutLoadChart()"/>\r\n                                Remove Outliers\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <div ng-if="chartProperties.type == \'Column Chart\'">\r\n                        <label>Group By:&nbsp;</label>\r\n                        <div class="restrict-dropdown-menu input-group">\r\n                            <input type="text" class="form-control"\r\n                                   ng-model="chartProperties.group_by"\r\n                                   typeahead="column as column.text for column in getValidColumns(categoricalColumns) | filter:$viewValue:$emptyOrMatch | orderBy:\'text.toString()\'"\r\n                                   typeahead-on-select="apiHandle.api.loadChart()"\r\n                                   typeahead-focus/>\r\n                            <span class="dhc-clickable input-group-addon" ng-click="chartProperties.group_by = undefined;apiHandle.api.loadChart()">\r\n                                <strong>X</strong>\r\n                            </span>\r\n                        </div>\r\n                    </div>\r\n                    <div ng-if="chartProperties.type != \'Column Chart\' && chartProperties.type != \'Scattered Plot\'">\r\n                        There are no other options for this type of chart\r\n                    </div>\r\n                </div>\r\n            </span>\r\n        </span>\r\n        <span class="flex-sub-container-right">\r\n            <span ng-hide="chartOptions.disableChartType" dhc-click-outside dhc-open-state="states.menuDisplays.changeChartType"\r\n                              dhc-close-callback="toggleSlide(!states.menuDisplays.changeChartType,\'change-chart-type\')">\r\n                <a class="clickable" style="text-decoration:none;padding-right:20px;"\r\n                   ng-click="toggleSlide(!states.menuDisplays.changeChartType,\'change-chart-type\');selected=\'\';">\r\n                    <span class="fake-anchor-tag">Chart type</span>\r\n                    <i class="fa" ng-class="{\'fa-chevron-up\': states.menuDisplays.changeChartType, \'fa-chevron-down\': !states.menuDisplays.changeChartType}"></i>\r\n                </a>\r\n                <div class="change-chart-type floating-form" style="display: none;width:450px;right: 0px;">\r\n                    <label>Chart Type:</label>\r\n                    <br/>\r\n                    <div class="btn-group">\r\n                        <label class="btn btn-primary" ng-model="chartProperties.type" btn-radio="\'Pie Chart\'" ng-click="changeChartType()">Pie Chart</label>\r\n                        <label class="btn btn-primary" ng-model="chartProperties.type" btn-radio="\'Box Plot\'" ng-click="changeChartType()">Box Plot</label>\r\n                        <label class="btn btn-primary" ng-model="chartProperties.type" btn-radio="\'Column Chart\'" ng-click="changeChartType()">Column Chart</label>\r\n                        <label class="btn btn-primary" ng-model="chartProperties.type" btn-radio="\'Scattered Plot\'" ng-click="changeChartType()">Scattered Plot</label>\r\n                    </div>\r\n                    <br/>\r\n                    <br/>\r\n                    <label>Data to show:</label>\r\n                    <br/>\r\n                    <div class="btn-group">\r\n                        <label class="btn btn-primary" ng-model="chartProperties.dataToShow" btn-radio="\'all\'" ng-click="apiHandle.api.timeoutLoadChart()">All Data</label>\r\n                        <label class="btn btn-primary" ng-model="chartProperties.dataToShow" btn-radio="\'selected\'" ng-click="apiHandle.api.timeoutLoadChart()">Selected Data</label>\r\n                    </div>\r\n                </div>\r\n            </span>\r\n            <span ng-hide="chartOptions.disableExporting">\r\n                <span class="clickable" style="padding-right:5px;color:#005da0;" ng-click="exportXLS()"><i class="fa fa-file-excel-o"></i></span>\r\n                <span class="clickable" style="padding-right:5px;color:#005da0;" ng-click="exportPDF()"><i class="fa fa-file-pdf-o"></i></span>\r\n            </span>\r\n            <span class="clickable" style="padding-right:5px;color:#005da0;" ng-repeat="customButton in customButtons" ng-click="customButton.callback()">\r\n                <i class="fa" ng-class="customButton.faClass"></i>\r\n            </span>\r\n        </span>\r\n    </div>\r\n    <hr ng-hide="allPanelHidden()"/>\r\n    <div class="chart-area-container">\r\n        <i ng-show="isProcessing" class="fa fa-spinner fa-spin fa-3x spinner" style="position:absolute;top:0;left:0"></i>\r\n        <!-- this is where the stock chart goes -->\r\n        <div style="position:relative;height:100%">\r\n            <alert ng-show="states.needAttrs" close="states.needAttrs = false" type="warning" style="font-size: 12px;position: absolute;z-index:999">\r\n                Please enter required attributes\r\n            </alert>\r\n            <div class="dhc-chart-toolbar" ng-show="apiHandle.api.excludedPoints.length > 0">\r\n                <a class="clickable" ng-click="apiHandle.api.resetExcludedPoints()">\r\n                    Reset Points <i class="fa fa-refresh"></i>\r\n                </a>\r\n            </div>\r\n            <div ng-attr-id="{{chartId}}" style="width:100%;height:100%;" ng-class="{\'dhc-opaque\': states.needAttrs}">\r\n            </div>\r\n        </div>\r\n        <alert ng-show="alerts.generalWarning.active" style="position:absolute;bottom:0;right:0;"\r\n               close="alerts.generalWarning.active = false" type="danger">\r\n            {{alerts.generalWarning.message}}\r\n        </alert>\r\n    </div>\r\n</div>')}]);